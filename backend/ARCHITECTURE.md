# TeamPlaner - 3-SÃ¤ulen-Architektur

## ğŸ›ï¸ Architektur-Ãœbersicht

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT (Vue.js Frontend)                      â”‚
â”‚                     http://localhost:8080                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTP/HTTPS
                               â”‚ X-Session-Id + Authorization Header
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXPRESS.JS API SERVER                             â”‚
â”‚                     http://localhost:3000                            â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Middleware Layer                                             â”‚  â”‚
â”‚  â”‚  â€¢ requireAuth (Session Check)                                â”‚  â”‚
â”‚  â”‚  â€¢ requirePermission (SpiceDB Check)                          â”‚  â”‚
â”‚  â”‚  â€¢ rateLimit (Redis Check)                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Routes                                                        â”‚  â”‚
â”‚  â”‚  â€¢ /api/auth   (login, register, logout)                      â”‚  â”‚
â”‚  â”‚  â€¢ /api/teams  (CRUD mit Permission Checks)                   â”‚  â”‚
â”‚  â”‚  â€¢ /api/projects                                               â”‚  â”‚
â”‚  â”‚  â€¢ /api/settings (Cache Sync)                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                   â”‚                     â”‚
    â”‚ 1. Data          â”‚ 2. Session          â”‚ 3. Permission
    â”‚    (SSOT)        â”‚    & Cache          â”‚    Check
    â–¼                   â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL  â”‚  â”‚    Redis     â”‚  â”‚     SpiceDB        â”‚
â”‚   :5432     â”‚  â”‚    :6379     â”‚  â”‚      :50051        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Datenfluss-Beispiele

### 1. Login-Prozess
```
Client                    API Server              PostgreSQL    Redis    SpiceDB
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚ POST /api/auth/login      â”‚                        â”‚          â”‚         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ Check Rate Limit       â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ Validate Credentials   â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚         â”‚
  â”‚                           â”‚ (email + password_hash)â”‚          â”‚         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ Create Session         â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
  â”‚                           â”‚ SET session:uuid (24h) â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ Cache User Settings    â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚         â”‚
  â”‚                           â”‚ SELECT settings        â”‚          â”‚         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
  â”‚                           â”‚ SET setting:* (1h)     â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ Audit Log              â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚         â”‚
  â”‚                           â”‚ INSERT audit_logs      â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚ { sessionId, token }      â”‚                        â”‚          â”‚         â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚          â”‚         â”‚
```

### 2. GeschÃ¼tzte Resource Abrufen (mit Permission Check)
```
Client                    API Server              PostgreSQL    Redis    SpiceDB
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚ GET /api/teams/:teamId    â”‚                        â”‚          â”‚         â”‚
  â”‚ Headers:                  â”‚                        â”‚          â”‚         â”‚
  â”‚   X-Session-Id: uuid      â”‚                        â”‚          â”‚         â”‚
  â”‚   Authorization: token    â”‚                        â”‚          â”‚         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ [requireAuth Middleware]          â”‚         â”‚
  â”‚                           â”‚ Validate Session       â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
  â”‚                           â”‚ GET session:uuid       â”‚          â”‚         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ [requirePermission Middleware]    â”‚         â”‚
  â”‚                           â”‚ Check Permission       â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                           â”‚ CheckPermission(       â”‚          â”‚         â”‚
  â”‚                           â”‚   user:uuid,           â”‚          â”‚         â”‚
  â”‚                           â”‚   "view",              â”‚          â”‚         â”‚
  â”‚                           â”‚   team:teamId          â”‚          â”‚         â”‚
  â”‚                           â”‚ )                      â”‚          â”‚         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                           â”‚ HAS_PERMISSION: true   â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ Get Team Data          â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚         â”‚
  â”‚                           â”‚ SELECT * FROM teams    â”‚          â”‚         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚ { team: {...} }           â”‚                        â”‚          â”‚         â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚          â”‚         â”‚
```

### 3. Setting Speichern (Write-Through Pattern)
```
Client                    API Server              PostgreSQL    Redis    SpiceDB
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚ PUT /api/settings/        â”‚                        â”‚          â”‚         â”‚
  â”‚     user/:id/:key         â”‚                        â”‚          â”‚         â”‚
  â”‚ Body: { value: {...} }    â”‚                        â”‚          â”‚         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ Auth Check (via Redis) â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ 1. Write to DB (SSOT)  â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚         â”‚
  â”‚                           â”‚ INSERT/UPDATE settings â”‚          â”‚         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ 2. Write to Cache      â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
  â”‚                           â”‚ SET setting:user:id:keyâ”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚ { success: true }         â”‚                        â”‚          â”‚         â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚          â”‚         â”‚
```

### 4. Setting Lesen (Cache-Aside Pattern)
```
Client                    API Server              PostgreSQL    Redis    SpiceDB
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚ GET /api/settings/        â”‚                        â”‚          â”‚         â”‚
  â”‚     user/:id/:key         â”‚                        â”‚          â”‚         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ 1. Try Cache           â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
  â”‚                           â”‚ GET setting:user:id:keyâ”‚          â”‚         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
  â”‚                           â”‚ Cache HIT!             â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚ { value: {...} }          â”‚                        â”‚          â”‚         â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚ â”€â”€â”€ Cache MISS Szenario â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ 2. Load from DB        â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚         â”‚
  â”‚                           â”‚ SELECT setting_value   â”‚          â”‚         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚         â”‚
  â”‚                           â”‚                        â”‚          â”‚         â”‚
  â”‚                           â”‚ 3. Cache for next time â”‚          â”‚         â”‚
  â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚
  â”‚                           â”‚ SET setting:* (1h TTL) â”‚          â”‚         â”‚
```

## ğŸ” Security: Fail-Closed Strategie

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SpiceDB Connection Status         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Connected?    â”‚
         â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
             â”‚ YES    â”‚ NO
             â”‚        â”‚
             â–¼        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Check       â”‚  â”‚ Fail-Closed:     â”‚
    â”‚ Permission  â”‚  â”‚ DENY ACCESS      â”‚
    â”‚ in SpiceDB  â”‚  â”‚ (Security First) â”‚
    â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚      â”‚
    YESâ”‚      â”‚NO
       â”‚      â”‚
       â–¼      â–¼
  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
  â”‚ALLOWâ”‚  â”‚ DENY â”‚
  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ Service Responsibilities

### PostgreSQL (SSOT)
```
âœ“ User accounts & credentials
âœ“ Organizations, Teams, Projects
âœ“ Boards, Cards
âœ“ Persistent Settings
âœ“ Audit Logs
âœ“ Referential Integrity
âœ— Sessions (in Redis!)
âœ— Permissions (in SpiceDB!)
```

### Redis (Cache & Sessions)
```
âœ“ User Sessions (24h TTL)
âœ“ Cached Settings (1h TTL)
âœ“ Rate Limiting Counters
âœ“ Temporary Data
âœ— Persistent Data (in PostgreSQL!)
âœ— Permissions (in SpiceDB!)
```

### SpiceDB (Authorization)
```
âœ“ Relationships (user â†’ team â†’ project)
âœ“ Permission Checks
âœ“ Hierarchical Permissions
âœ“ ReBAC Logic
âœ— User Attributes (Email, Name etc.)
âœ— Business Data
âœ— Settings
```

## ğŸ”„ Synchronisation & Consistency

### Settings Synchronisation
```
PostgreSQL (SSOT)  â†â”€â”€Writeâ”€Throughâ”€â”€â”€  Redis (Cache)
      â”‚                                       â”‚
      â”‚ Source of Truth                      â”‚ Performance Layer
      â”‚ Persistent                            â”‚ TTL: 1 hour
      â”‚ Full History                          â”‚ Volatile
      â”‚                                       â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Cacheâ”€Invalidationâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  (on DELETE/UPDATE)
```

### Session & Permission Flow
```
1. Login
   â”œâ”€> PostgreSQL: Validate credentials
   â”œâ”€> Redis: Create session
   â””â”€> SpiceDB: (No action, permissions already set)

2. API Request
   â”œâ”€> Redis: Validate session
   â”œâ”€> SpiceDB: Check permission (FAIL-CLOSED!)
   â””â”€> PostgreSQL: Fetch data (if authorized)

3. Logout
   â”œâ”€> Redis: Delete session
   â””â”€> PostgreSQL: Audit log
```

## ğŸš€ Quick Start

```bash
# 1. Alle Services starten
cd backend
docker-compose up -d

# 2. Warte bis alle healthy sind
docker-compose ps

# 3. SpiceDB Schema hochladen
npm run spicedb:upload-schema

# 4. Health Check
curl http://localhost:3000/health

# 5. Test Login
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test1234","firstName":"Test","lastName":"User"}'
```

## ğŸ“Š Monitoring

### Health Checks
- PostgreSQL: `docker exec teamplaner_postgres pg_isready`
- Redis: `docker exec teamplaner_redis redis-cli ping`
- SpiceDB: `curl http://localhost:8443/healthz`
- Backend: `curl http://localhost:3000/health`

### Logs
```bash
# Alle Services
docker-compose logs -f

# Nur Backend
docker-compose logs -f backend

# Nur SpiceDB
docker-compose logs -f spicedb
```

---

**Gebaut mit â¤ï¸ fÃ¼r hochskalierbare Microservices**
